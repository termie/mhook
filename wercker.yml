box: tcnksm/gox@0.1.0
build:
  steps:
      - script:
          name: install
          code: go get -v -d ./...

      - golint

      - tcnksm/gox:
            os: "darwin linux"
            arch: "386 amd64"

      - script:
          name: prepare
          code: |
              echo $WERCKER_GIT_COMMIT > $WERCKER_OUTPUT_DIR/HEAD
              mv $WERCKER_OUTPUT_DIR/pkg $WERCKER_OUTPUT_DIR/latest
              cp -r $WERCKER_OUTPUT_DIR/latest $WERCKER_OUTPUT_DIR/$WERCKER_GIT_COMMIT
deploy:
  steps:
    - s3sync:
        key-id: $AWS_ACCESS_KEY_ID
        key-secret: $AWS_SECRET_ACCESS_KEY
        bucket-url: $AWS_BUCKET_URL/$WERCKER_GIT_BRANCH/
        delete-removed: false
        source-dir: "."
